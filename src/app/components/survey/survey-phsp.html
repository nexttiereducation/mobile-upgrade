<form #phspSurveyForm="ngForm" *ngIf="studentAnswers.page">
  <div [class.height-100]="hideFormNavButtons">
    <ng-template [ngIf]="studentAnswers.page === 1">
      <div class="surveyQuestion small">
        What is your post high school plan?
        <span [class.text-red]="plan.touched && plan.invalid">*</span>
      </div>
      <ion-list name="plan"
                radio-group
                required
                (ionChange)="onPlanChanged(plan)"
                [(ngModel)]="studentAnswers.plan"
                #plan="ngModel">
        <ion-item *ngFor="let plan of plans">
          <ion-radio [value]="plan.value" item-start></ion-radio>
          <ion-label>{{ plan.name }}</ion-label>
        </ion-item>
      </ion-list>
    </ng-template>
    <ng-template [ngIf]="!isShortSurvey">
      <ng-template [ngIf]="isUniversityPlan">
        <ng-template [ngIf]="!taskTracker.isComplete">
          <ng-template [ngIf]="studentAnswers.page === 2">
            <survey-phsp-colleges [list]="studentAnswers.institutions_followed"
                                  [startOnLastSlide]="startOnLastSlide">
            </survey-phsp-colleges>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.page === 3">
            <div class="surveyQuestion small">
              Which college do you plan to attend?
              <span [class.text-red]="college_attending_id.touched && college_attending_id.invalid">*</span>
            </div>
            <ion-item class="no-label">
              <ion-select name="college_attending"
                          interface="popover"
                          placeholder="Select college"
                          required
                          [(ngModel)]="studentAnswers.college_attending_id"
                          (ionChange)="onCollegeAttendingChanged($event)"
                          #college_attending_id="ngModel">
                <ion-option [value]="-1">To be decided</ion-option>
                <ion-option *ngFor="let college of acceptedColleges" [value]="college.id">
                  {{ college.name }}
                </ion-option>
              </ion-select>
            </ion-item>
            <div class="surveyQuestion small">
              What is your intended major or field of study?
              <span [class.text-red]="major.touched && major.invalid">*</span>
            </div>
            <ion-item>
              <ion-input name="major"
                         placeholder="Intended major / field of study"
                         required
                         type="text"
                         [(ngModel)]="studentAnswers.major"
                         #major="ngModel"></ion-input>
            </ion-item>
            <ng-template [ngIf]="studentAnswers.college_attending_id && studentAnswers.college_attending_id !== -1">
              <div class="surveyQuestion small">If any, how much financial aid are you receiving from this college?</div>
              <ion-item>
                <span item-start>$</span>
                <ion-input name="financial_aid"
                           min="1"
                           pattern="[0-9]*"
                           placeholder="ex: 5000"
                           type="number"
                           [(ngModel)]="studentAnswers.financial_aid"
                           #financial_aid="ngModel"></ion-input>
                <span item-end>.00</span>
              </ion-item>
              <div class="surveyQuestion small">
                What is your intended start date?
                <span [class.text-red]="start_date.touched && start_date.invalid">*</span>
              </div>
              <ion-item class="no-label">
                <ion-icon name="calendar" color="primary" item-start></ion-icon>
                <ion-datetime name="start_date"
                              displayFormat="MM/DD/YYYY"
                              pickerFormat="MMMM/DD/YYYY"
                              placeholder="Start date"
                              required
                              type="datetime-local"
                              [max]="maxYear"
                              [min]="minYear"
                              [pickerOptions]="datePickerOptions"
                              [(ngModel)]="studentAnswers.start_date"
                              #start_date="ngModel"></ion-datetime>
              </ion-item>
            </ng-template>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.page === 4">
            <survey-phsp-scholarships [list]="studentAnswers.scholarships_followed"
                                      [startOnLastSlide]="startOnLastSlide">
            </survey-phsp-scholarships>
          </ng-template>
        </ng-template>
        <ng-template [ngIf]="studentAnswers.page === 5 || taskTracker.isComplete">
          <survey-phsp-results-college class="bg-grayLight"
                                       *ngIf="surveyResults"
                                       [surveyResults]="surveyResults"
                                       [taskIsComplete]="taskTracker.isComplete">
          </survey-phsp-results-college>
        </ng-template>
      </ng-template>
      <ng-template [ngIf]="!isUniversityPlan">
        <ng-template [ngIf]="studentAnswers.page === 2 && !taskTracker.isComplete">
          <ng-template [ngIf]="studentAnswers.plan === 'military'">
            <div class="surveyQuestion small">
              Which branch of the military do you plan to enter?
              <span [class.text-red]="branch.touched && branch.invalid">*</span>
            </div>
            <ion-list name="branch"
                      radio-group
                      required
                      [(ngModel)]="studentAnswers.branch"
                      #branch="ngModel">
              <ion-item *ngFor="let branch of militaryBranches">
                <ion-radio item-start [value]="branch.value"></ion-radio>
                <ion-label>{{ branch.name }}</ion-label>
                <ion-avatar item-end>
                  <img [src]="branch.logo" />
                </ion-avatar>
              </ion-item>
              <ion-item style="height: 57px">
                <ion-radio item-start value="To be determined"></ion-radio>
                <ion-label>To be determined</ion-label>
              </ion-item>
            </ion-list>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.plan === 'workforce'">
            <div class="surveyQuestion small">
              Who will be your employer?
              <span [class.text-red]="employer.touched && employer.invalid">*</span>
            </div>
            <ion-item>
              <ion-input name="employer"
                         placeholder="Employer"
                         required
                         type="text"
                         [(ngModel)]="studentAnswers.employer"
                         #employer="ngModel"></ion-input>
            </ion-item>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.plan === 'other'">
            <div class="surveyQuestion small">
              Please describe your post high school plan.
              <span [class.text-red]="custom_plan.touched && custom_plan.invalid">*</span>
            </div>
            <ion-item>
              <ion-textarea name="custom_plan"
                            placeholder="Take a year off, attend a college prep school, not graduating this year, not sure yet, etc..."
                            required
                            type="text"
                            [(ngModel)]="studentAnswers.custom_plan"
                            #custom_plan="ngModel"></ion-textarea>
            </ion-item>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.plan === 'trade'">
            <div class="surveyQuestion small">
              What school do you plan to attend?
              <span [class.text-red]="trade_school.touched && trade_school.invalid">*</span>
            </div>
            <ion-item>
              <ion-input name="trade_school"
                         placeholder="Trade/vocational school"
                         required
                         type="text"
                         [(ngModel)]="studentAnswers.trade_school"
                         #trade_school="ngModel"></ion-input>
            </ion-item>
            <div class="surveyQuestion small">
              What trade/vocational certification will you be pursuing?
              <span [class.text-red]="certification.touched && certification.invalid">*</span>
            </div>
            <ion-item>
              <ion-input name="certification"
                         placeholder="Trade/vocational certification"
                         required
                         type="text"
                         [(ngModel)]="studentAnswers.certification"
                         #certification="ngModel"></ion-input>
            </ion-item>
          </ng-template>
          <ng-template [ngIf]="studentAnswers.plan !== 'other'">
            <div class="surveyQuestion small">
              What is your intended start date?
              <span [class.text-red]="start_date.touched && start_date.invalid">*</span>
            </div>
            <ion-item class="no-label">
              <ion-icon name="calendar" color="primary" item-start></ion-icon>
              <ion-datetime name="start_date"
                            displayFormat="MM/DD/YYYY"
                            pickerFormat="MMMM/DD/YYYY"
                            placeholder="Start date"
                            required
                            type="datetime-local"
                            [max]="maxYear"
                            [min]="minYear"
                            [pickerOptions]="datePickerOptions"
                            [(ngModel)]="studentAnswers.start_date"
                            #start_date="ngModel"></ion-datetime>
            </ion-item>
          </ng-template>
        </ng-template>
        <ng-template [ngIf]="studentAnswers.page === 3 || taskTracker.isComplete">
          <survey-phsp-results class="bg-grayLight"
                               *ngIf="surveyResults"
                               [answers]="surveyResults.answers"
                               [taskIsComplete]="taskTracker.isComplete"></survey-phsp-results>
        </ng-template>
      </ng-template>
    </ng-template>
    <ng-template [ngIf]="isShortSurvey && (studentAnswers.page === 2 || taskTracker.isComplete)">
      <div class="md-headline task-text md-margin">
        You plan to <span class="md-font-bold text-green-brand">{{ planDescriptions[studentAnswers.plan] }}.</span>
      </div>
    </ng-template>
  </div>
  <ion-grid padding-10 *ngIf="!hideFormNavButtons && !taskTracker.isComplete">
    <ion-row>
      <ion-col *ngIf="studentAnswers.page > 1">
        <button ion-button block clear
                color="steel"
                type="button"
                (click)="previousPage()">
          Back
        </button>
      </ion-col>
      <ion-col>
        <button ion-button block
                color="orange"
                type="button"
                *ngIf="!isLastQuestion && !isConfirmationPage && !isShortSurvey"
                [disabled]="phspSurveyForm.form.invalid || isInvalid"
                (click)="nextPage()">
          Continue
        </button>
        <button ion-button block
                color="orange"
                type="button"
                *ngIf="isLastQuestion && !isConfirmationPage"
                [disabled]="phspSurveyForm.form.invalid || isInvalid"
                (click)="viewConfirmation()">
          Finish Survey
        </button>
        <button ion-button block
                color="orange"
                type="submit"
                *ngIf="(studentAnswers.page === 1 && isShortSurvey) ||
                       (isConfirmationPage && !isLastQuestion)"
                [disabled]="phspSurveyForm.form.invalid || isInvalid"
                (click)="surveyComplete()">
          Submit
        </button>
      </ion-col>
    </ion-row>
  </ion-grid>
</form>
<loading *ngIf="!studentAnswers.page"></loading>
