<form [formGroup]="testPromptForm">
  <ion-list radio-group formControlName="isTakingTest"
            (ionChange)="checkForm()">
    <ion-item>
      <ion-radio item-start [value]="false"></ion-radio>
      <ion-label>I'm not taking it</ion-label>
    </ion-item>
    <ion-item>
      <ion-radio item-start [value]="true"></ion-radio>
      <ion-label>I am taking it</ion-label>
    </ion-item>
  </ion-list>
  <div [hidden]="!isTakingTest.value">
    <div class="medium" padding>{{ prompt.question }}</div>
    <ion-list formArrayName="knownDatesArray" no-margin>
      <ion-item *ngFor="let choiceGroup of knownDateControls; let i = index" [formGroupName]="i">
        <ion-checkbox formControlName="checked"
                      item-start
                      [checked]="knownDateControls[i].controls.date.value.isChosen"
                      (ionChange)="markSelected(knownDateControls[i].controls.date.value)"></ion-checkbox>
        <ion-label>{{knownDateControls[i].controls.date.value.id === 0 ?
                     knownDateControls[i].controls.date.value.value :
                     (knownDateControls[i].controls.date.value.value | date:'MMM dd, yyyy')}}</ion-label>
      </ion-item>
    </ion-list>
    <ion-list formArrayName="customDatesArray"
              [hidden]="!lastChoiceSelected">
      <ion-item class="no-label"
                *ngFor="let deadline of customDateControls; let i = index"
                [formGroupName]="i">
        <ion-icon item-start name="calendar" color="grayDark50"></ion-icon>
        <ion-datetime displayFormat="MM/DD/YYYY"
                      formControlName="date"
                      name="start_date"
                      pickerFormat="MMMM/DD/YYYY"
                      placeholder="MM/DD/YYYY"
                      type="datetime-local"
                      [max]="maxYear"
                      [min]="minYear"
                      [pickerOptions]="datePickerOptions"
                      [required]="lastChoiceSelected && !simplifiedForm">
        </ion-datetime>
        <button ion-button clear icon-only item-end
                color="red"
                type="button"
                *ngIf="customDateControls.length > 1"
                (click)="removeCustomDate(i)">
          <ion-icon name="close"></ion-icon>
        </button>
      </ion-item>
    </ion-list>
    <button ion-button
            color="primary"
            margin-horizontal margin-bottom
            [disabled]="customDates.invalid"
            [hidden]="!lastChoiceSelected"
            (click)="addCustomDeadline()">
      Add date
    </button>
  </div>
</form>
<ion-footer>
  <ion-toolbar color="green">
    <button ion-button clear full
            color="white"
            [disabled]="testPromptForm.invalid"
            (click)="submit()">
      Save
    </button>
  </ion-toolbar>
</ion-footer>
